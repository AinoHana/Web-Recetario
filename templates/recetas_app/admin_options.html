{% extends 'base.html' %}
{% load static %}

{% block extra_head %}
    <!-- Cargar los estilos específicos del panel de administración -->
    <link rel="stylesheet" href="{% static 'css/admin_panel.css' %}">
{% endblock %}

{% block content %}
    <div class="admin-container">
        <header class="header">
            <h1>PANEL DE ADMINISTRACIÓN</h1>
            <p>Gestiona las recetas, categorías, usuarios y comentarios de tu sitio.</p>
        </header>
    
        <nav>
            <ul class="nav-tabs" role="tablist">
                <li><a href="#" class="nav-tab-link active" data-url="{% url 'recetas_app:admin_recetas' %}">Recetas</a></li>
                <li><a href="#" class="nav-tab-link" data-url="{% url 'recetas_app:admin_categorias' %}">Categorías</a></li>
                <li><a href="#" class="nav-tab-link" data-url="{% url 'recetas_app:admin_usuarios' %}">Administrar Usuarios</a></li>
                <li><a href="#" class="nav-tab-link" data-url="{% url 'recetas_app:admin_comentarios' %}">Administrar Comentarios</a></li>
            </ul>
        </nav>
    
        <div id="content-area">
            <!-- El contenido cargado vía AJAX se inyectará aquí -->
            <p>Selecciona una opción para empezar.</p>
        </div>
    </div>

    <!-- El script se mantiene aquí ya que manipula el DOM del bloque de contenido -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const tabs = document.querySelectorAll('.nav-tab-link');
            const contentArea = document.getElementById('content-area');

            function loadContent(url) {
                contentArea.innerHTML = '<div class="loading-overlay"><div class="loading-spinner"></div></div>';
                
                fetch(url, {
                    method: 'GET',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.html_content) {
                        contentArea.innerHTML = data.html_content;
                    } else {
                        contentArea.innerHTML = '<p style="color: red;">Error: La respuesta no contiene el contenido HTML.</p>';
                    }
                })
                .catch(error => {
                    console.error('Error al cargar el contenido:', error);
                    contentArea.innerHTML = `<p style="color: red;">Ocurrió un error al cargar el contenido: ${error.message}</p>`;
                });
            }

            tabs.forEach(tab => {
                tab.addEventListener('click', function(event) {
                    event.preventDefault();
                    
                    tabs.forEach(item => item.classList.remove('active'));
                    this.classList.add('active');
                    
                    const url = this.getAttribute('data-url');
                    
                    if (url) {
                        loadContent(url);
                    }
                });
            });

            // Agrega un escuchador de eventos para los botones de CRUD dentro del área de contenido.
            // Usa event delegation para manejar clics en elementos que se cargan dinámicamente.
            contentArea.addEventListener('click', function(event) {
                const button = event.target.closest('[data-action]');
                if (button) {
                    event.preventDefault();
                    const action = button.getAttribute('data-action');
                    const url = button.getAttribute('data-url');

                    if (url) {
                        if (action === 'delete' || action === 'eliminar') {
                            if (confirm('¿Estás seguro de que quieres eliminar este elemento?')) {
                                loadContent(url);
                            }
                        } else {
                            loadContent(url);
                        }
                    }
                }
            });


            const initialTab = document.querySelector('.nav-tab-link.active');
            if (initialTab) {
                loadContent(initialTab.getAttribute('data-url'));
            }
        });
    </script>
{% endblock %}
