{% extends 'base.html' %}
{% load static %}

{% block extra_head %}
    <!-- Cargar los estilos específicos del panel de administración -->
    <link rel="stylesheet" href="{% static 'css/admin_panel.css' %}">
{% endblock %}

{% block content %}
    <div class="admin-container">
        <header class="header">
            <h1>PANEL DE ADMINISTRACIÓN</h1>
            <p>Gestiona las recetas, categorías, usuarios y comentarios de tu sitio.</p>
        </header>
    
        <nav>
            <ul class="nav-tabs" role="tablist">
                <li><a href="#" class="nav-tab-link active" data-url="{% url 'recetas_app:admin_recetas' %}">Recetas</a></li>
                <li><a href="#" class="nav-tab-link" data-url="{% url 'recetas_app:admin_categorias' %}">Categorías</a></li>
                <li><a href="#" class="nav-tab-link" data-url="{% url 'recetas_app:admin_usuarios' %}">Administrar Usuarios</a></li>
                <li><a href="#" class="nav-tab-link" data-url="{% url 'recetas_app:admin_comentarios' %}">Administrar Comentarios</a></li>
            </ul>
        </nav>
    
        <div id="content-area">
            <!-- El contenido cargado vía AJAX se inyectará aquí -->
            <p>Selecciona una opción para empezar.</p>
        </div>
    </div>

    <!-- El script se mantiene aquí ya que manipula el DOM del bloque de contenido -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Selecciona todos los enlaces de las pestañas de navegación
            const tabs = document.querySelectorAll('.nav-tab-link');
            const contentArea = document.getElementById('content-area');

            // Función para cargar el contenido de una URL vía AJAX
            function loadContent(url) {
                // Muestra un indicador de carga
                contentArea.innerHTML = '<div class="loading-overlay"><div class="loading-spinner"></div></div>';
                
                // Realiza la petición Fetch
                fetch(url, {
                    method: 'GET',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                })
                .then(response => {
                    // Verifica si la respuesta es exitosa (código 200)
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json(); // Ahora sí, parsea la respuesta como JSON
                })
                .then(data => {
                    // Si el JSON contiene 'html_content', inyecta ese contenido
                    if (data.html_content) {
                        contentArea.innerHTML = data.html_content;
                    } else {
                        contentArea.innerHTML = '<p style="color: red;">Error: La respuesta no contiene el contenido HTML.</p>';
                    }
                })
                .catch(error => {
                    // Maneja cualquier error de red o de la petición
                    console.error('Error al cargar el contenido:', error);
                    contentArea.innerHTML = `<p style="color: red;">Ocurrió un error al cargar el contenido: ${error.message}</p>`;
                });
            }

            // Agrega un escuchador de eventos a cada pestaña
            tabs.forEach(tab => {
                tab.addEventListener('click', function(event) {
                    event.preventDefault(); // Previene la recarga de la página
                    
                    // Remueve la clase 'active' de todas las pestañas
                    tabs.forEach(item => item.classList.remove('active'));
                    
                    // Agrega la clase 'active' a la pestaña clicada
                    this.classList.add('active');
                    
                    // Obtiene la URL de la pestaña clicada
                    const url = this.getAttribute('data-url');
                    
                    // Llama a la función para cargar el contenido
                    if (url) {
                        loadContent(url);
                    }
                });
            });

            // Opcional: Cargar el contenido de la primera pestaña al iniciar la página
            const initialTab = document.querySelector('.nav-tab-link.active');
            if (initialTab) {
                loadContent(initialTab.getAttribute('data-url'));
            }
        });
    </script>
{% endblock %}
